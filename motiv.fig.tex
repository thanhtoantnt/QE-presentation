\begin{figure}

\centering
\code{c = \createlatch(2);}

\vspace{-12pt}
\[
\left(
\begin{tabular}{ 
  l@{\extracolsep{\fill}} || 
  l@{\extracolsep{\fill}} || 
  l@{\extracolsep{\fill}} }
\BCOMMENT{\SPEC{$T_1$}} & \BCOMMENT{\SPEC{$T_2$}} & \BCOMMENT{\SPEC{$T_3$}}\\
\BCOMMENT{\SPEC{\code{$h{:=}h_s\code{cos}\frac{\theta}{2}$;}}} & 
\BCOMMENT{\SPEC{\code{$r{:=}h_s\code{sin}\frac{\theta}{2}$;}}} & \\
\code{countDown(c);} & \code{countDown(c);} & \code{await(c);}\\
& & \BCOMMENT{\SPEC{\code{$V{:=}\frac{1}{3}\pi r^2 h$;~}}}\\
\end{tabular}\!\!\right)%\!\!\code{;}
\]

\pause
\begin{tikzpicture}[every node/.style={anchor=base,
    text height=.8em,text depth=.2em,minimum size=7mm},
    ->, >=stealth']
    
  \matrix{
    \node[] (lbl) {\code{cnt=2}};\\
    %\node[fill=gray!30] (cnt_init) {$2$};\\
    \node[fill=gray!30,draw] (cnt_2) {$2$};\\
    \node[fill=gray!20,draw] (cnt_1) {$1$};\\
    \node[fill=gray!10,draw] (cnt_0) {$0$};\\
    \node[] (cnt_end) {};\\
  };
  
    \node[left= of cnt_2] (tm) {$T_3$};
    \node[left= of cnt_1] (t1) {$T_1$};
    \node[left= of cnt_0] (t2) {$T_2$};
  
    \node[right=15pt of cnt_2] (wait) {awaiting $\ldots$};
    \node[right=15pt of cnt_1] (cont_1) {$T_1$, continue};
    \node[right=15pt of cnt_0] (cont_2) {$T_2$, continue};
    \node[right=15pt of cnt_end] (cont_m) {$T_3$, resume};
  
  \path (tm) edge node [->, scale=.58, auto] {\code{await()}} (cnt_2);
  \path (t1) edge node [->, scale=.58, auto] {\code{countDown()}} (cnt_1);
  \path (t2) edge node [->, scale=.58, auto] {\code{countDown()}} (cnt_0);
  
  %\draw [->, dashed] (cnt_2) to node [] {} (wait);
  \draw [->, dashed] (cnt_1) -- node [] {} (cont_1);
  \draw [->, dashed] (cnt_0) -- node [] {} (cont_2);
  \draw [->, dashed, auto] (cnt_0) |- node [below] {\code{cnt=0}} (cont_m);
\end{tikzpicture}
%% \caption{A use-case of %% synchronization pattern with
%%   {\CDL}}
%% \label{fig:latch_wait_for_consume}
\end{figure}
